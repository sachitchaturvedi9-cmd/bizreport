<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BizReport AI â€” Investor Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=IBM+Plex+Mono:wght@400;600&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --bg:#08090a;--surface:#111214;--surface2:#1a1c20;--border:#2a2d33;
  --accent:#c8ff00;--accent2:#00d4ff;--text:#e8eaed;--muted:#6b7280;
  --red:#ff4d6d;--green:#39d98a;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--text);font-family:'Syne',sans-serif;min-height:100vh;padding:20px;}
body::before{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:0;opacity:0.4;}
.wrapper{position:relative;z-index:1;max-width:1100px;margin:0 auto;}
.header{display:flex;align-items:center;justify-content:space-between;padding:20px 0 40px;border-bottom:1px solid var(--border);margin-bottom:40px;}
.logo{font-family:'DM Serif Display',serif;font-size:1.8rem;letter-spacing:-0.02em;}
.logo span{color:var(--accent);}
.badge{font-family:'IBM Plex Mono',monospace;font-size:0.65rem;color:var(--accent);border:1px solid var(--accent);padding:4px 10px;border-radius:2px;letter-spacing:0.1em;}
.key-section{margin-bottom:20px;}
.key-row{display:flex;gap:12px;align-items:center;}
.search-section{display:flex;gap:12px;margin-bottom:50px;}
.search-wrap{flex:1;position:relative;}
.search-wrap input,.key-section input{width:100%;background:var(--surface);border:1px solid var(--border);color:var(--text);font-family:'Syne',sans-serif;font-size:1rem;padding:16px 20px;border-radius:4px;outline:none;transition:border-color .2s;}
.search-wrap input:focus,.key-section input:focus{border-color:var(--accent);}
.search-wrap input::placeholder,.key-section input::placeholder{color:var(--muted);}
.btn-primary{background:var(--accent);color:#000;border:none;font-family:'Syne',sans-serif;font-size:0.95rem;font-weight:800;padding:16px 32px;border-radius:4px;cursor:pointer;letter-spacing:0.05em;white-space:nowrap;transition:transform .15s,background .15s;}
.btn-primary:hover{background:#d4ff26;transform:translateY(-1px);}
.btn-primary:active{transform:translateY(0);}
.btn-primary:disabled{opacity:0.5;cursor:not-allowed;transform:none;}
.btn-secondary{background:#2a2d33;color:var(--accent);border:1px solid var(--accent);font-family:'Syne',sans-serif;font-size:0.85rem;font-weight:700;padding:16px 20px;border-radius:4px;cursor:pointer;white-space:nowrap;}
.btn-link{background:none;border:none;color:var(--muted);font-family:'IBM Plex Mono',monospace;font-size:0.7rem;cursor:pointer;text-decoration:underline;margin-top:6px;display:inline-block;}
#keyStatus{font-family:'IBM Plex Mono',monospace;font-size:0.72rem;margin-top:8px;padding-left:2px;min-height:16px;}
#loader{display:none;text-align:center;padding:60px 20px;}
.loader-inner{display:inline-flex;flex-direction:column;align-items:center;gap:20px;}
.spinner{width:40px;height:40px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}
.loader-text{font-family:'IBM Plex Mono',monospace;font-size:0.8rem;color:var(--muted);letter-spacing:0.05em;}
#errorBox{display:none;background:rgba(255,77,109,.1);border:1px solid var(--red);border-radius:4px;padding:20px 24px;font-family:'IBM Plex Mono',monospace;font-size:0.85rem;color:var(--red);margin-bottom:30px;}
#reportArea{display:none;}
.report-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:40px;flex-wrap:wrap;gap:20px;}
.company-name{font-family:'DM Serif Display',serif;font-size:clamp(2rem,5vw,3.5rem);line-height:1.1;letter-spacing:-0.03em;}
.company-meta{display:flex;flex-direction:column;align-items:flex-end;gap:8px;}
.ticker-badge{font-family:'IBM Plex Mono',monospace;font-size:1rem;font-weight:600;color:var(--accent);background:rgba(200,255,0,.1);border:1px solid rgba(200,255,0,.3);padding:6px 14px;border-radius:2px;}
.sector-tag{font-family:'IBM Plex Mono',monospace;font-size:0.7rem;color:var(--muted);letter-spacing:0.1em;}
.company-desc{color:var(--muted);font-size:1rem;line-height:1.7;margin-bottom:40px;max-width:700px;border-left:2px solid var(--accent);padding-left:20px;}
.kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:1px;background:var(--border);border:1px solid var(--border);border-radius:6px;overflow:hidden;margin-bottom:40px;}
.kpi-card{background:var(--surface);padding:24px 20px;position:relative;overflow:hidden;}
.kpi-card::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:var(--accent);transform:scaleX(0);transition:transform .3s;transform-origin:left;}
.kpi-card:hover::after{transform:scaleX(1);}
.kpi-label{font-family:'IBM Plex Mono',monospace;font-size:0.65rem;color:var(--muted);letter-spacing:0.12em;text-transform:uppercase;margin-bottom:10px;}
.kpi-value{font-family:'DM Serif Display',serif;font-size:1.6rem;letter-spacing:-0.02em;line-height:1;margin-bottom:6px;}
.kpi-change{font-family:'IBM Plex Mono',monospace;font-size:0.7rem;font-weight:600;}
.up{color:var(--green);}
.down{color:var(--red);}
.neutral{color:var(--muted);}
.charts-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;}
@media(max-width:700px){.charts-grid{grid-template-columns:1fr;}}
.chart-card{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:24px;}
.chart-card.full{grid-column:1/-1;}
.chart-title{font-family:'IBM Plex Mono',monospace;font-size:0.7rem;color:var(--muted);letter-spacing:0.12em;text-transform:uppercase;margin-bottom:20px;}
.insights-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;}
@media(max-width:700px){.insights-grid{grid-template-columns:1fr;}}
.insight-card{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:24px;}
.insight-title{font-family:'IBM Plex Mono',monospace;font-size:0.7rem;letter-spacing:0.12em;text-transform:uppercase;margin-bottom:16px;}
.insight-title.risks{color:var(--red);}
.insight-title.opps{color:var(--green);}
.insight-list{list-style:none;display:flex;flex-direction:column;gap:10px;}
.insight-list li{font-size:0.88rem;color:#c0c4cc;padding-left:16px;position:relative;line-height:1.5;}
.insight-list li::before{content:'â€”';position:absolute;left:0;color:var(--muted);font-size:0.7rem;}
.verdict-card{background:var(--surface2);border:1px solid var(--border);border-radius:6px;padding:28px;display:flex;gap:24px;align-items:center;flex-wrap:wrap;}
.verdict-score{font-family:'DM Serif Display',serif;font-size:4rem;color:var(--accent);line-height:1;min-width:90px;}
.verdict-text h3{font-family:'IBM Plex Mono',monospace;font-size:0.7rem;color:var(--muted);letter-spacing:0.12em;text-transform:uppercase;margin-bottom:8px;}
.verdict-text p{font-size:0.95rem;color:#c0c4cc;line-height:1.6;}
.verdict-label{font-family:'DM Serif Display',serif;font-size:1.5rem;color:var(--text);margin-bottom:6px;}
.footer{margin-top:50px;padding-top:20px;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;}
.footer-text{font-family:'IBM Plex Mono',monospace;font-size:0.65rem;color:var(--muted);letter-spacing:0.08em;}
</style>
</head>
<body>
<div class="wrapper">
  <div class="header">
    <div class="logo">Biz<span>Report</span> AI</div>
    <div class="badge">INVESTOR INTELLIGENCE</div>
  </div>

  <!-- API Key Section -->
  <div class="key-section" id="keySection">
    <div class="key-row">
      <div class="search-wrap">
        <input type="password" id="apiKeyInput" placeholder="OpenRouter API Key daalo â€” openrouter.ai se free milti hai" />
      </div>
      <button class="btn-secondary" onclick="saveKey()">SAVE KEY</button>
    </div>
    <div id="keyStatus"></div>
  </div>

  <div style="margin-bottom:16px;"><button class="btn-link" style="color:#c8ff00;font-family:IBM Plex Mono,monospace;font-size:0.75rem;background:none;border:1px solid #2a2d33;padding:8px 16px;border-radius:4px;cursor:pointer;" onclick="localStorage.removeItem('gemini_key');document.getElementById('keySection').style.display='block';this.parentElement.style.display='none'">ðŸ”‘ Change API Key</button></div><div class="search-section">
    <div class="search-wrap">
      <input type="text" id="companyInput" placeholder="Company name daalo â€” e.g. Apple, Reliance, Samsung" />
    </div>
    <button class="btn-primary" onclick="getReport()" id="searchBtn">ANALYSE â†’</button>
  </div>

  <div id="errorBox"></div>
  <div id="loader">
    <div class="loader-inner">
      <div class="spinner"></div>
      <div class="loader-text">FETCHING INVESTOR DATA...</div>
    </div>
  </div>

  <div id="reportArea">
    <div class="report-header">
      <div class="company-name" id="compName"></div>
      <div class="company-meta">
        <div class="ticker-badge" id="tickerBadge"></div>
        <div class="sector-tag" id="sectorTag"></div>
      </div>
    </div>
    <p class="company-desc" id="compDesc"></p>
    <div class="kpi-grid" id="kpiGrid"></div>
    <div class="charts-grid">
      <div class="chart-card">
        <div class="chart-title">Revenue Trend (USD B)</div>
        <canvas id="revenueChart" height="180"></canvas>
      </div>
      <div class="chart-card">
        <div class="chart-title">Profit Margin (%)</div>
        <canvas id="marginChart" height="180"></canvas>
      </div>
      <div class="chart-card full">
        <div class="chart-title">Segment Revenue Breakdown (%)</div>
        <canvas id="segmentChart" height="120"></canvas>
      </div>
    </div>
    <div class="insights-grid">
      <div class="insight-card">
        <div class="insight-title risks">âš  Key Risks</div>
        <ul class="insight-list" id="riskList"></ul>
      </div>
      <div class="insight-card">
        <div class="insight-title opps">â†‘ Growth Opportunities</div>
        <ul class="insight-list" id="oppList"></ul>
      </div>
    </div>
    <div class="verdict-card">
      <div class="verdict-score" id="verdictScore"></div>
      <div class="verdict-text">
        <h3>AI Analyst Verdict</h3>
        <div class="verdict-label" id="verdictLabel"></div>
        <p id="verdictDesc"></p>
      </div>
    </div>
    <div class="footer">
      <div class="footer-text">AI-GENERATED REPORT Â· NOT FINANCIAL ADVICE Â· FOR EDUCATIONAL USE ONLY</div>
      <div class="footer-text" id="reportDate"></div>
    </div>
  </div>
</div>

<script>
var charts = {};

// â”€â”€ Key Management â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveKey() {
  var key = document.getElementById('apiKeyInput').value.trim();
  if (!key) { setKeyStatus('Pehle key enter karo!', 'red'); return; }
  localStorage.setItem('gemini_key', key);
  document.getElementById('apiKeyInput').value = '';
  document.getElementById('keySection').style.display = 'none';
  setKeyStatus('', '');
}

function getKey() {
  return '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';
}

function setKeyStatus(msg, color) {
  var el = document.getElementById('keyStatus');
  if (!el) return;
  el.textContent = msg;
  el.style.color = color === 'green' ? '#39d98a' : color === 'red' ? '#ff4d6d' : '#6b7280';
}

function showError(msg) {
  var box = document.getElementById('errorBox');
  box.textContent = '\u26A0 ' + msg;
  box.style.display = 'block';
  document.getElementById('loader').style.display = 'none';
  document.getElementById('searchBtn').disabled = false;
}

window.addEventListener('load', function() {
  document.getElementById('keySection').style.display = 'none';
  document.getElementById('companyInput').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') getReport();
  });
});
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function getReport() {
  var company = document.getElementById('companyInput').value.trim();
  if (!company) { showError('Company ka naam toh dalo bhai!'); return; }

  var apiKey = getKey();
  if (!apiKey) {
    document.getElementById('keySection').style.display = 'block';
    showError('Pehle OpenRouter API Key save karo upar wale box mein!');
    return;
  }

  var loader = document.getElementById('loader');
  var reportArea = document.getElementById('reportArea');
  var errorBox = document.getElementById('errorBox');
  var btn = document.getElementById('searchBtn');

  loader.style.display = 'block';
  reportArea.style.display = 'none';
  errorBox.style.display = 'none';
  btn.disabled = true;

  Object.values(charts).forEach(function(c) { if (c) c.destroy(); });
  charts = {};

  var prompt = 'You are a financial analyst AI. Generate a comprehensive investor report for "' + company + '".\n\nReturn ONLY valid JSON, no markdown, no explanation, no backticks. Use this exact structure:\n{\n  "name": "Full Company Name",\n  "ticker": "TICKER",\n  "sector": "Technology",\n  "description": "2 sentence business description for investors.",\n  "kpis": {\n    "market_cap": "$2.8T",\n    "market_cap_change": "+12% YoY",\n    "revenue": "$383B",\n    "revenue_change": "+8% YoY",\n    "net_income": "$97B",\n    "net_income_change": "+13% YoY",\n    "pe_ratio": "28.5x",\n    "pe_change": "neutral",\n    "debt_to_equity": "1.2",\n    "debt_change": "neutral",\n    "roe": "147%",\n    "roe_change": "+5% YoY",\n    "eps": "$6.11",\n    "eps_change": "+10% YoY",\n    "dividend_yield": "0.5%",\n    "div_change": "neutral"\n  },\n  "revenue_trend": {\n    "years": ["2020","2021","2022","2023","2024"],\n    "values": [274.5, 365.8, 394.3, 383.3, 391.0]\n  },\n  "margin_trend": {\n    "years": ["2020","2021","2022","2023","2024"],\n    "gross": [38.2, 41.8, 43.3, 44.1, 46.2],\n    "net": [20.9, 25.9, 25.3, 25.3, 26.4]\n  },\n  "segments": {\n    "labels": ["Segment A","Segment B","Segment C","Segment D"],\n    "values": [50, 25, 15, 10]\n  },\n  "risks": ["Risk 1","Risk 2","Risk 3","Risk 4"],\n  "opportunities": ["Opportunity 1","Opportunity 2","Opportunity 3","Opportunity 4"],\n  "verdict": {\n    "score": "8.2",\n    "label": "Strong Buy",\n    "summary": "2-3 sentence analyst summary."\n  }\n}\nUse realistic estimated figures. If company is private, estimate based on available info.';

  try {
    var response = await fetch(
      'https://openrouter.ai/api/v1/chat/completions',
      {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + apiKey.replace(/[^\x20-\x7E]/g, '').trim()
        },
        body: JSON.stringify({
          model: 'meta-llama/llama-3.1-8b-instruct:free',
          messages: [{ role: 'user', content: prompt }]
        })
      }
    );

    if (!response.ok) {
      var errData = await response.json().catch(function() { return {}; });
      var errMsg = (errData.error && errData.error.message) ? errData.error.message : ('HTTP ' + response.status);
      if (response.status === 401 || response.status === 403) {
        localStorage.removeItem('gemini_key');
        document.getElementById('keySection').style.display = 'block';
        showError('API Key invalid hai. Naya key daalo. (' + errMsg + ')');
        return;
      }
      throw new Error(errMsg);
    }

    var data = await response.json();
    var rawText = (data.choices && data.choices[0] && data.choices[0].message) ? data.choices[0].message.content : '';
    if (!rawText) throw new Error('Empty response from API');

    rawText = rawText.replace(/```json|```/g, '').trim();

    var d;
    try {
      d = JSON.parse(rawText);
    } catch(e) {
      var match = rawText.match(/\{[\s\S]*\}/);
      if (match) d = JSON.parse(match[0]);
      else throw new Error('JSON parse failed. API ne galat format diya.');
    }

    renderReport(d);

  } catch (err) {
    console.error(err);
    showError(err.message + ' â€” Please try again.');
  } finally {
    loader.style.display = 'none';
    btn.disabled = false;
  }
}

function renderReport(d) {
  document.getElementById('compName').textContent = d.name;
  document.getElementById('tickerBadge').textContent = d.ticker;
  document.getElementById('sectorTag').textContent = d.sector.toUpperCase();
  document.getElementById('compDesc').textContent = d.description;
  document.getElementById('reportDate').textContent = new Date().toDateString().toUpperCase();

  var kpiDefs = [
    { label: 'Market Cap',       value: d.kpis.market_cap,      change: d.kpis.market_cap_change },
    { label: 'Revenue (TTM)',     value: d.kpis.revenue,         change: d.kpis.revenue_change },
    { label: 'Net Income',        value: d.kpis.net_income,      change: d.kpis.net_income_change },
    { label: 'P/E Ratio',         value: d.kpis.pe_ratio,        change: d.kpis.pe_change },
    { label: 'Debt / Equity',     value: d.kpis.debt_to_equity,  change: d.kpis.debt_change },
    { label: 'Return on Equity',  value: d.kpis.roe,             change: d.kpis.roe_change },
    { label: 'EPS',               value: d.kpis.eps,             change: d.kpis.eps_change },
    { label: 'Dividend Yield',    value: d.kpis.dividend_yield,  change: d.kpis.div_change }
  ];

  var grid = document.getElementById('kpiGrid');
  grid.innerHTML = '';
  kpiDefs.forEach(function(k) {
    var isUp   = k.change && k.change.includes('+');
    var isDown = k.change && k.change.includes('-') && !k.change.toLowerCase().includes('neutral');
    var cls    = isUp ? 'up' : (isDown ? 'down' : 'neutral');
    grid.innerHTML += '<div class="kpi-card"><div class="kpi-label">' + k.label + '</div><div class="kpi-value">' + k.value + '</div><div class="kpi-change ' + cls + '">' + k.change + '</div></div>';
  });

  var cOpts = function(legend) {
    return {
      responsive: true,
      plugins: { legend: { display: !!legend, labels: { color: '#6b7280', font: { family: 'IBM Plex Mono', size: 10 } } } },
      scales: {
        x: { ticks: { color: '#6b7280', font: { family: 'IBM Plex Mono', size: 10 } }, grid: { color: 'rgba(255,255,255,0.04)' } },
        y: { ticks: { color: '#6b7280', font: { family: 'IBM Plex Mono', size: 10 } }, grid: { color: 'rgba(255,255,255,0.04)' }, beginAtZero: false }
      }
    };
  };

  charts.revenue = new Chart(document.getElementById('revenueChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: d.revenue_trend.years,
      datasets: [{ label: 'Revenue (B)', data: d.revenue_trend.values, backgroundColor: 'rgba(200,255,0,0.7)', borderRadius: 3 }]
    },
    options: cOpts(false)
  });

  charts.margin = new Chart(document.getElementById('marginChart').getContext('2d'), {
    type: 'line',
    data: {
      labels: d.margin_trend.years,
      datasets: [
        { label: 'Gross Margin %', data: d.margin_trend.gross, borderColor: '#c8ff00', backgroundColor: 'rgba(200,255,0,0.1)', tension: 0.4, fill: true, pointRadius: 3 },
        { label: 'Net Margin %',   data: d.margin_trend.net,   borderColor: '#00d4ff', backgroundColor: 'rgba(0,212,255,0.05)', tension: 0.4, fill: true, pointRadius: 3 }
      ]
    },
    options: cOpts(true)
  });

  var segColors = ['rgba(200,255,0,0.75)','rgba(0,212,255,0.75)','rgba(255,77,109,0.75)','rgba(57,217,138,0.75)','rgba(180,120,255,0.75)'];
  var segOpts = cOpts(false);
  segOpts.indexAxis = 'y';
  charts.segment = new Chart(document.getElementById('segmentChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: d.segments.labels,
      datasets: [{ label: 'Revenue Share %', data: d.segments.values, backgroundColor: segColors, borderRadius: 3 }]
    },
    options: segOpts
  });

  document.getElementById('riskList').innerHTML = d.risks.map(function(r) { return '<li>' + r + '</li>'; }).join('');
  document.getElementById('oppList').innerHTML  = d.opportunities.map(function(o) { return '<li>' + o + '</li>'; }).join('');

  document.getElementById('verdictScore').textContent = d.verdict.score;
  document.getElementById('verdictLabel').textContent = d.verdict.label;
  document.getElementById('verdictDesc').textContent  = d.verdict.summary;

  document.getElementById('reportArea').style.display = 'block';
  document.getElementById('reportArea').scrollIntoView({ behavior: 'smooth', block: 'start' });
}
</script>
</body>
</html>
